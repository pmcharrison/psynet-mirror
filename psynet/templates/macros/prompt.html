{% macro simple(config) %}
    {% if config.text is not none %}
        <div style="margin-top:15px; margin-bottom: 15px;">
            {{ config.text }}
        </div>
    {% endif %}
{% endmacro %}

{% macro audio(config) %}
    {{ simple(config) }}

    <script>
        {% if config.prevent_response %}
            psynet.response.wait_for("audio_prompt");
        {% endif %}

        {% if config.prevent_submit %}
            psynet.submit.wait_for("audio_prompt");
        {% endif %}

        psynet.media.register_on_loaded_routine(function() {
            var sound = psynet.audio.prompt.play({
                loop: {{ config.loop | lower }}
            });

            sound.source.addEventListener("ended", function() {
                psynet.response.ready("audio_prompt");
                psynet.submit.ready("audio_prompt");
            });

            {% if config.enable_submit_after is not none %}
                setTimeout(
                    ()=> psynet.submit.ready("audio_prompt"),
                    1000 * {{ config.enable_submit_after }}
                );
            {% endif %}
        })
    </script>
{% endmacro %}
